from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils.executor import start_webhook
import logging
import os
import aiohttp
import asyncio
from datetime import datetime

API_TOKEN = os.getenv("API_TOKEN")
RENDER_EXTERNAL_URL = os.getenv("RENDER_EXTERNAL_URL")
WEBHOOK_PATH = "/webhook"
WEBHOOK_URL = RENDER_EXTERNAL_URL + WEBHOOK_PATH

logging.basicConfig(level=logging.INFO, filename="bot.log", filemode="a",
                    format="%(asctime)s - %(levelname)s - %(message)s")

bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

menu = ReplyKeyboardMarkup(resize_keyboard=True)
menu.add(KeyboardButton("üöÄ –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ"), KeyboardButton("üìò –û –∫—É—Ä—Å–µ"))
menu.add(KeyboardButton("üéÅ –ü—Ä–æ–±–Ω—ã–π —É—Ä–æ–∫"), KeyboardButton("üí≥ –ö—É–ø–∏—Ç—å —á–∞—Å—Ç—å 1 (3990 ‚ÇΩ)"))
menu.add(KeyboardButton("üíº –ö—É–ø–∏—Ç—å –≤–µ—Å—å –∫—É—Ä—Å (7990 ‚ÇΩ)"), KeyboardButton("üõ† –ü–æ–¥–¥–µ—Ä–∂–∫–∞"))

@dp.message_handler(commands=['start'])
async def start(message: types.Message):
    await message.answer("""üß† –ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫—É—Ä—Å. –≠—Ç–æ —Ç–≤–æ–π –≤—Ö–æ–¥ –≤ —ç–ø–æ—Ö—É ChatGPT. ‚ùì–¢—ã —Å–ª—ã—à–∞–ª –ø—Ä–æ ChatGPT, –Ω–æ –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –ø–æ–Ω–∏–º–∞–µ—à—å, –∫–∞–∫ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? –ò–ª–∏ —É–∂–µ –ø—Ä–æ–±–æ–≤–∞–ª, –Ω–æ –±—ã—Å—Ç—Ä–æ ‚Äú–∑–∞—Å—Ç—Ä—è–ª‚Äù –Ω–∞ —ç—Ç–∞–ø–µ ¬´–Ω–∞–ø–∏—à–∏ —Å–∫–∞–∑–∫—É –ø—Ä–æ –¥—Ä–∞–∫–æ–Ω–∞¬ª?  –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å. –ó–¥–µ—Å—å —Ç—ã –Ω–∞—É—á–∏—à—å—Å—è –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å —Å ChatGPT, –∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.  ‚ö°Ô∏è –ü–æ—á–µ–º—É —ç—Ç–æ—Ç –∫—É—Ä—Å –Ω—É–∂–µ–Ω —Ç–µ–±–µ –∏–º–µ–Ω–Ω–æ —Å–µ–π—á–∞—Å ChatGPT —É–∂–µ –∏–∑–º–µ–Ω–∏–ª —Ä—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞, –±–∏–∑–Ω–µ—Å, –æ–±—É—á–µ–Ω–∏–µ. üõ† –ï–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∏, —é—Ä–∏—Å—Ç—ã, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏, –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏, SMM-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã, –¥–∏–∑–∞–π–Ω–µ—Ä—ã, –ø—Ä–æ–µ–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä—ã.  –ù–æ 95% –ª—é–¥–µ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–≥–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –í–≤–æ–¥—è—Ç –≥–ª—É–ø—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–ª—É—á–∞—é—Ç –≥–ª—É–ø—ã–µ –æ—Ç–≤–µ—Ç—ã –∏ –¥—É–º–∞—é—Ç: ‚Äú–û–Ω —Ç—É–ø–æ–π‚Äù.  –ù–µ—Ç. –û–Ω –Ω–µ —Ç—É–ø–æ–π. –û–Ω —Ç–æ—á–Ω–æ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç —Ç–≤–æ–∏ –∫–æ–º–∞–Ω–¥—ã. –ï—Å–ª–∏ —Ç—ã –¥–∞—ë—à—å —Å–ª–∞–±—É—é –∫–æ–º–∞–Ω–¥—É ‚Äî –ø–æ–ª—É—á–∞–µ—à—å —Å–ª–∞–±—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.  –ê —Ç–µ–ø–µ—Ä—å –≤–Ω–∏–º–∞–Ω–∏–µ:  üí° ChatGPT ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è. –ò –º—ã –µ—ë —Ç–µ–±–µ –¥–∞–¥–∏–º.  üìö –ß—Ç–æ —Ç–µ–±—è –∂–¥—ë—Ç –≤–Ω—É—Ç—Ä–∏ –∫—É—Ä—Å–∞ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ChatGPT –∏ –∫–∞–∫ –¥—É–º–∞–µ—Ç –ò–ò  –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–º—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥ –∏ –∫–∞–∫ –ø–∏—Å–∞—Ç—å —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö —É –º–æ–¥–µ–ª–∏ ‚Äú–≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç‚Äù  –ö–∞–∫ —Ä–µ—à–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏: –æ—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤ –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–æ–≤, –ª–µ–Ω–¥–∏–Ω–≥–æ–≤, –±–∏–∑–Ω–µ—Å-–∏–¥–µ–π, –∫–Ω–∏–≥, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π –∏ –¥–∞–∂–µ Excel-—Ñ–æ—Ä–º—É–ª  –ö–∞–∫ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é ChatGPT  –ö–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏—Ö GPT-–∞–≥–µ–Ω—Ç–æ–≤: –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã, –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç—ã, –ø—Ä–æ–¥–∞–≤—Ü—ã, –º–µ—Ç–æ–¥–∏—Å—Ç—ã  –í—Å—ë —ç—Ç–æ ‚Äî –ø–æ—à–∞–≥–æ–≤–æ, —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏, —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º–∏, –∑–∞–¥–∞–Ω–∏—è–º–∏ –∏ —à–∞–±–ª–æ–Ω–∞–º–∏.  üîç –ê –µ—Å–ª–∏ —Ç—ã –Ω–æ–≤–∏—á–æ–∫? üü¢ –û—Ç–ª–∏—á–Ω–æ. –≠—Ç–æ—Ç –∫—É—Ä—Å —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ç–µ–±—è. –ú—ã –Ω–µ –Ω–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ—Ä–º–∏–Ω–∞–º–∏. –ú—ã –≥–æ–≤–æ—Ä–∏–º –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º:  –í–æ—Ç –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç  –í–æ—Ç –∫–∞–∫ —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å  –í–æ—Ç –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç  –¢—ã –ø–æ–ª—É—á–∞–µ—à—å:  –ü–æ–Ω—è—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É  –ü–æ–¥–¥–µ—Ä–∂–∫—É  –õ–æ–≥–∏–∫—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å  üîß –ß—Ç–æ —Ç—ã –Ω–∞—É—á–∏—à—å—Å—è –¥–µ–ª–∞—Ç—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ: ‚úÖ –ü–∏—Å–∞—Ç—å —Ç–∞–∫–∏–µ –ø—Ä–æ–º—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏—Ö –ø–æ–º–æ—â–Ω–∏–∫–æ–≤ ‚Äî –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö, –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ, –≤ –æ–±—É—á–µ–Ω–∏–∏ ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å –≤ –ª—é–±—ã—Ö —Å—Ñ–µ—Ä–∞—Ö: HR, —Ñ–∏–Ω–∞–Ω—Å—ã, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥, –¥–∏–∑–∞–π–Ω, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ‚úÖ –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å: –¥–µ–ª–∞—Ç—å ChatGPT-–ø—Ä–æ–¥—É–∫—Ç—ã, —É—Å–ª—É–≥–∏, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –Ω–µ –∫–∞–∫ ‚Äú–∏–≥—Ä—É—à–∫—É‚Äù, –∞ –∫–∞–∫ —Ä–∞–±–æ—á–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç  üë®‚Äçüè´ –ö—É—Ä—Å —Å–æ–∑–¥–∞–ª –ê—Ä–∫–∞–¥–∏–π ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ ChatGPT –£ –ê—Ä–∫–∞–¥–∏—è 10+ –ª–µ—Ç –≤ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏, 2 –≥–æ–¥–∞ –≤ –ò–ò. –û–Ω –¥–µ–ª–∞–µ—Ç –Ω–µ ‚Äú–µ—â—ë –æ–¥–∏–Ω –∫—É—Ä—Å‚Äù, –∞ —Å–∏—Å—Ç–µ–º—É –æ–±—É—á–µ–Ω–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π ChatGPT —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∞—Å—Ç—å—é —Ç–≤–æ–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.  üí• –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ —Ç—ã –ø—Ä–æ–π–¥—ë—à—å —ç—Ç–æ—Ç –∫—É—Ä—Å? –¢—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—à—å –±—ã—Ç—å ‚Äú–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–º‚Äù —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ä–µ–≤–æ–ª—é—Ü–∏–∏  –¢—ã —Å—Ç–∞–Ω–µ—à—å —Ç–µ–º, –∫—Ç–æ —É–º–µ–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ò–ò ‚Äî —Ä–µ–∞–ª—å–Ω–æ, –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ  –£ —Ç–µ–±—è –±—É–¥–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ–¥ —Ç–µ–±—è  –£ —Ç–µ–±—è –±—É–¥–µ—Ç –Ω–∞–≤—ã–∫, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ —Å–µ–π—á–∞—Å –ø–æ–∫—É–ø–∞—é—Ç –Ω–∞ —Ñ—Ä–∏–ª–∞–Ω—Å–µ –∏ –≤ –∫–æ–º–ø–∞–Ω–∏—è—Ö  üéÅ –ü–æ–ø—Ä–æ–±—É–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ü–µ—Ä–≤—ã–π —É—Ä–æ–∫ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π. –ü—Ä–æ—Å—Ç–æ —á—Ç–æ–±—ã —Ç—ã –ø–æ–Ω—è–ª: —ç—Ç–æ –Ω–µ ‚Äú–≤–æ–¥–∞‚Äù, —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.  –ï—Å–ª–∏ –∑–∞–π–¥—ë—Ç ‚Äî –ø—Ä–æ—Ö–æ–¥–∏—à—å –¥–∞–ª—å—à–µ, –æ–ø–ª–∞—á–∏–≤–∞–µ—à—å –¥–æ—Å—Ç—É–ø –∏ –∏–¥—ë—à—å –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.  üí≥ –°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç? üì¶ –ë–∞–∑–æ–≤–∞—è —á–∞—Å—Ç—å: 3990 ‚ÇΩ ‚Äî –æ—Å–Ω–æ–≤—ã ChatGPT, –ø—Ä–∞–∫—Ç–∏–∫–∞, –Ω–∞–≤—ã–∫–∏  üîì –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —á–∞—Å—Ç—å: 7990 ‚ÇΩ ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤, –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏  üéØ –¶–µ–ª—å ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ–±—É—á–µ–Ω–∏–µ, –∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —É —Ç–µ–±—è –±—É–¥–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –Ω–∞–≤—ã–∫ –∏ –≥–æ—Ç–æ–≤—ã–π –ò–ò-–ø—Ä–æ–¥—É–∫—Ç  üîò –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å? –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Äî –∏ –Ω–∞—á–Ω–∏ —Å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —É—Ä–æ–∫–∞  –ü—Ä–æ—á—É–≤—Å—Ç–≤—É–π —Å—Ç–∏–ª—å  –£–±–µ–¥–∏—Å—å –≤ —Ü–µ–Ω–Ω–æ—Å—Ç–∏  –ü—Ä–æ–π–¥–∏ ‚Äî –∏ –æ–ø–ª–∞—Ç–∏, –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—á–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ò–ò –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª  ‚ùóÔ∏è–¢—ã –º–æ–∂–µ—à—å –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â—ë –≥–æ–¥. –ê –º–æ–∂–µ—à—å —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π —Å–∫–∞–∑–∞—Ç—å: ‚Äú–Ø —Ç–µ–ø–µ—Ä—å –ø–æ–Ω–∏–º–∞—é, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ò–ò –≤ –∂–∏–∑–Ω–∏ –∏ –≤ —Ä–∞–±–æ—Ç–µ. –ò —É–º–µ—é —ç—Ç–æ –¥–µ–ª–∞—Ç—å.‚Äù""")
    await message.answer("üëá –í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∏–∂–µ:", reply_markup=menu)

@dp.message_handler(lambda msg: msg.text == "üõ† –ü–æ–¥–¥–µ—Ä–∂–∫–∞")
async def support(message: types.Message):
    await message.answer("üì© –ù–∞–ø–∏—à–∏ –Ω–∞–º: @your_support")

async def ping_self():
    async with aiohttp.ClientSession() as session:
        while True:
            try:
                async with session.get(RENDER_EXTERNAL_URL) as resp:
                    logging.info(f"Ping status: {resp.status} at {datetime.now()}")
            except Exception as e:
                logging.warning(f"Ping error: {e}")
            await asyncio.sleep(300)

async def on_startup(dp):
    async with aiohttp.ClientSession() as session:
        async with session.get(f"https://api.telegram.org/bot{API_TOKEN}/getWebhookInfo") as resp:
            data = await resp.json()
            if not data['result']['url']:
                await bot.set_webhook(WEBHOOK_URL)
                logging.info("Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏")
    asyncio.create_task(ping_self())

async def on_shutdown(dp):
    await bot.delete_webhook()
    logging.info("Webhook –æ—Ç–∫–ª—é—á—ë–Ω –∏ –±–æ—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É.")

if __name__ == '__main__':
    start_webhook(
        dispatcher=dp,
        webhook_path=WEBHOOK_PATH,
        on_startup=on_startup,
        on_shutdown=on_shutdown,
        skip_updates=True,
        host="0.0.0.0",
        port=int(os.environ.get("PORT", 5000)),
    )
